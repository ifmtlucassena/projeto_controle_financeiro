{% extends "base.html" %}

{% block title %}Nova Transação - Controle Financeiro{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-2xl font-semibold text-gray-900 tracking-tight">Nova Transação</h1>
        <p class="text-sm text-gray-500 mt-1">Registre uma entrada ou saída financeira.</p>
    </div>

    <div class="bg-white shadow-sm border border-gray-200 rounded-xl p-6 md:p-8">
        <form method="POST" action="/nova-transacao" id="formTransacao" class="space-y-6">
            
            <!-- Transaction Type Toggle -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">Tipo de Transação</label>
                <div class="grid grid-cols-2 gap-4">
                    <label class="relative cursor-pointer">
                        <input type="radio" name="tipo" value="receita" class="peer sr-only" required>
                        <div class="p-4 rounded-lg border border-gray-200 text-center transition-all hover:bg-gray-50 peer-checked:border-emerald-500 peer-checked:bg-emerald-50 peer-checked:text-emerald-700">
                            <i class="bi bi-arrow-up-circle text-xl mb-1 block"></i>
                            <span class="font-medium text-sm">Receita</span>
                        </div>
                    </label>
                    <label class="relative cursor-pointer">
                        <input type="radio" name="tipo" value="despesa" class="peer sr-only" required>
                        <div class="p-4 rounded-lg border border-gray-200 text-center transition-all hover:bg-gray-50 peer-checked:border-rose-500 peer-checked:bg-rose-50 peer-checked:text-rose-700">
                            <i class="bi bi-arrow-down-circle text-xl mb-1 block"></i>
                            <span class="font-medium text-sm">Despesa</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Amount and Date -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="valor" class="block text-sm font-medium text-gray-700 mb-1.5">Valor</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">R$</span>
                        </div>
                        <input type="number" name="valor" id="valor" step="0.01" min="0.01" required placeholder="0,00"
                            class="block w-full pl-10 pr-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm placeholder-gray-400
                            focus:outline-none focus:border-gray-900 focus:ring-1 focus:ring-gray-900 transition-colors">
                    </div>
                </div>
                <div>
                    <label for="data" class="block text-sm font-medium text-gray-700 mb-1.5">Data</label>
                    <input type="date" name="data" id="data" required
                        class="block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm
                        focus:outline-none focus:border-gray-900 focus:ring-1 focus:ring-gray-900 transition-colors">
                </div>
            </div>

            <!-- Description -->
            <div>
                <label for="descricao" class="block text-sm font-medium text-gray-700 mb-1.5">Descrição</label>
                <input type="text" name="descricao" id="descricao" required maxlength="200" placeholder="Ex: Salário, Supermercado..."
                    class="block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm placeholder-gray-400
                    focus:outline-none focus:border-gray-900 focus:ring-1 focus:ring-gray-900 transition-colors">
            </div>

            <!-- Category -->
            <div>
                <label for="categoria" class="block text-sm font-medium text-gray-700 mb-1.5">Categoria</label>
                <select name="categoria" id="categoria" required
                    class="block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm
                    focus:outline-none focus:border-gray-900 focus:ring-1 focus:ring-gray-900 transition-colors">
                    <option value="">Selecione...</option>
                    <optgroup label="Receitas">
                        <option value="Trabalho">Trabalho/Salário</option>
                        <option value="Investimentos">Investimentos</option>
                        <option value="Freelance">Freelance</option>
                        <option value="Vendas">Vendas</option>
                        <option value="Outras Receitas">Outras Receitas</option>
                    </optgroup>
                    <optgroup label="Despesas">
                        <option value="Alimentação">Alimentação</option>
                        <option value="Transporte">Transporte</option>
                        <option value="Moradia">Moradia</option>
                        <option value="Saúde">Saúde</option>
                        <option value="Educação">Educação</option>
                        <option value="Lazer">Lazer</option>
                        <option value="Compras">Compras</option>
                        <option value="Outras Despesas">Outras Despesas</option>
                    </optgroup>
                </select>
            </div>

            <!-- Dynamic Fields: Receita -->
            <div id="camposReceita" class="hidden pt-4 border-t border-gray-100 animate-fade-in">
                <label for="conta_destino" class="block text-sm font-medium text-gray-700 mb-1.5">Conta de Destino</label>
                <input type="text" name="conta_destino" id="conta_destino" placeholder="Ex: Nubank"
                    class="block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm placeholder-gray-400
                    focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-colors">
            </div>

            <!-- Dynamic Fields: Despesa -->
            <div id="camposDespesa" class="hidden pt-4 border-t border-gray-100 space-y-6 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="metodo_pagamento" class="block text-sm font-medium text-gray-700 mb-1.5">Método de Pagamento</label>
                        <select name="metodo_pagamento" id="metodo_pagamento"
                            class="block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm
                            focus:outline-none focus:border-rose-500 focus:ring-1 focus:ring-rose-500 transition-colors">
                            <option value="">Selecione...</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Cartão de Débito">Cartão de Débito</option>
                            <option value="Cartão de Crédito">Cartão de Crédito</option>
                            <option value="PIX">PIX</option>
                            <option value="Transferência">Transferência</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div>
                        <label for="estabelecimento" class="block text-sm font-medium text-gray-700 mb-1.5">Estabelecimento</label>
                        <input type="text" name="estabelecimento" id="estabelecimento" placeholder="Ex: Supermercado"
                            class="block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm shadow-sm placeholder-gray-400
                            focus:outline-none focus:border-rose-500 focus:ring-1 focus:ring-rose-500 transition-colors">
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="pt-6 flex items-center justify-end gap-3">
                <a href="/" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                    Cancelar
                </a>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg hover:bg-gray-800 transition-colors shadow-sm">
                    Salvar Transação
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const radios = document.getElementsByName('tipo');
        const camposReceita = document.getElementById('camposReceita');
        const camposDespesa = document.getElementById('camposDespesa');
        const dataInput = document.getElementById('data');

        // Set default date to today
        if (!dataInput.value) {
            dataInput.valueAsDate = new Date();
        }

        function toggleFields() {
            let tipo = '';
            for(const radio of radios) {
                if(radio.checked) tipo = radio.value;
            }

            if (tipo === 'receita') {
                camposReceita.classList.remove('hidden');
                camposDespesa.classList.add('hidden');
                
                document.getElementById('conta_destino').required = true;
                document.getElementById('metodo_pagamento').required = false;
                document.getElementById('estabelecimento').required = false;
            } else if (tipo === 'despesa') {
                camposReceita.classList.add('hidden');
                camposDespesa.classList.remove('hidden');
                
                document.getElementById('conta_destino').required = false;
                document.getElementById('metodo_pagamento').required = true;
                document.getElementById('estabelecimento').required = true;
            }
        }

        radios.forEach(radio => radio.addEventListener('change', toggleFields));
    });
</script>
{% endblock %}
